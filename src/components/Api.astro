---
import { LinkCard, CardGrid } from "@astrojs/starlight/components";

interface Frontmatter {
  title: string;
  description?: string;
}

const allPosts = import.meta.glob<{ frontmatter: Frontmatter; url?: string }>("../content/docs/api/*.mdx");
const posts = await Promise.all(
  Object.entries(allPosts)
    .filter(([path]) => !path.endsWith("index.mdx"))
    .map(async ([path, loadPost]) => {
      const post = await loadPost();
      return {
        ...post,
        url: path.replace("../content/docs", "").replace(".mdx", "/")
      };
    })
);

function simplifyFilePath(filePath: string) {
  // Remove leading and trailing slashes
  filePath = filePath.replace(/^\/|\/$/g, "");

  // Split the path into parts using "/"
  const pathParts = filePath.split("/");

  // Get the last part of the path (file or directory name)
  const lastPart = pathParts[pathParts.length - 1].split("%20").join("-");

  // Remove file extension (assuming it's after the last dot in the last part)
  const simplifiedName = lastPart.split(".").slice(0, -1).join(".");

  return simplifiedName.toLowerCase(); // Convert to lowercase for consistency
}
---

<CardGrid stagger>
  {
    posts.map((post) => (
      <LinkCard
        title={post.frontmatter.title}
        description={post.frontmatter.description}
        href={simplifyFilePath(post.url?.toString() || "")}
      />
    ))
  }
</CardGrid>
